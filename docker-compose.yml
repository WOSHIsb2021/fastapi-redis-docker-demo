services:
  my-python-app:
    build: .
    # 这一行很重要！告诉 Python 容器：Redis 在这里
    environment:
      - REDIS_HOST=my-redis
    depends_on:
      - my-redis  # 必须等 Redis 启动了，Python 才能启动

  my-gateway:
    image: nginx:latest
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - my-python-app

  # 新增的积木块
  my-redis:
    image: redis:alpine
    # Redis 默认端口是 6379，虽然不用映射到 Windows，但容器间需要通
    volumes:
      # 格式：- 你的Windows路径 : 容器内路径
      - ./redis_data:/data
    command: redis-server --appendonly yes
